{% extends 'base.html.twig' %}
{% block title %}Patients Page{% endblock %}
{% block body %}

    <!-- Nav tabs -->
    <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" data-toggle="tab" href="#view" role="tab">View</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#create" role="tab">Create</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#export" role="tab">Export</a>
        </li>
    </ul>

    <br/>

    <!-- Tab panes -->
    <div class="tab-content">

        <div class="tab-pane active" id="view" role="tabpanel">
            <table id="patients" class="table table-striped table-bordered" cellspacing="0">
                <thead>
                <tr>
                    {#<th>ID</th>#}
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Medical ID</th>
                    <th>Manage</th>
                </tr>
                </thead>
                <tfoot>
                <tr>
                    {#<th>ID</th>#}
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Medical ID</th>
                    <th>Manage</th>
                </tr>
                </tfoot>
                <tbody>
                {% for patient in patientsQuery.active %}
                    <tr>
                        {#<td>{{ patient.id }}</td>#}
                        <td>{{ patient.firstName }}</td>
                        <td>{{ patient.lastName }}</td>
                        <td>{{ patient.medicalId }}</td>
                        <td>
                            <!-- Example split danger button -->
                            <div class="btn-group">
                                <a role="button" class="btn btn-primary" href="patient/{{ patient.uuid }}">View</a>
                                <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split"
                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <span class="sr-only">Toggle Dropdown</span>
                                </button>
                                <div class="dropdown-menu">
                                    <h6 class="dropdown-header">Create</h6>
                                    <a class="dropdown-item" href="#">Internal Incident</a>
                                    <a class="dropdown-item" href="#">Body Check</a>
                                    <a class="dropdown-item" href="#">Bowl Movement</a>
                                    <div class="dropdown-divider"></div>
                                    <h6 class="dropdown-header">Manage Data</h6>
                                    <a class="dropdown-item confirm-link"
                                       data-patient-name="{{ patient.firstName }} {{ patient.lastName }}"
                                       data-link="{{ patient.uuid }}/archive">Archive</a>
                                </div>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="tab-pane fade" id="create" role="tabpanel">
            <!-- Add Patient Form -->
            <form class="container form" id="patients_form" action="create/" method="POST">
                <div class="row">
                    <div class="form-group col-sm-6">
                        <label for="first_name" class="col-form-label">First Name</label>
                        <input id="first_name" name="first_name" class="form-control" placeholder="John" required>
                    </div>
                    <div class="form-group col-sm-6">
                        <label for="last_name" class="col-form-label">Last Name</label>
                        <input id="last_name" name="last_name" class="form-control" placeholder="Adams" required>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-sm-6">
                        <label for="medical_id" class="col-form-label">Medical ID</label>
                        <input id="medical_id" name="medical_id" class="form-control" placeholder="555111222" required
                               type="number">
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-sm-6">
                        <div class="form-check">
                            <label for="seizure" class="form-check-label">
                                <input name="seizure" class="form-check-input" type="checkbox"  value="seizure">
                                Does Patient have Seizures?
                            </label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-sm-6">
                        <div class="form-check">
                            <label for="bowel" class="form-check-label">
                                <input name="bowel" class="form-check-input" type="checkbox" value="bowel">
                                Monitor Patient's Bowel Movements?
                            </label>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-default" id="addobjective">Add Objective</button>
                <div class="text-center">
                    <button type="submit" class="btn btn-success btn-lg">Submit</button>
                </div>
            </form>
            <!-- End Add Patient Form -->
        </div>

        <div class="tab-pane" id="export" role="tabpanel">...</div>
    </div>


    <!-- Modals -->
    <div class="modal fade" id="archivePatientConfirmationModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Archiving Patient</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <br/>
                    <div class="alert alert-warning" role="alert">
                        <strong>Confirmation: </strong>
                        <span class="warning-message">
                            Are you sure you wish to archive <span class="patientName">patientX</span>
                        </span>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn btn-warning confirm">Archive Patient</a>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/dataTables.bootstrap4.min.css">
    <script src="//cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <script src="//cdn.datatables.net/1.10.16/js/dataTables.bootstrap4.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#patients').DataTable();
            $('[data-toggle="tooltip"]').tooltip()
        });
    </script>
    {#Script for handling objective addition. - Syed A#}
    <script type="text/javascript">
        $(document).ready(function() {
            var wrapper = $("#patients_form");
            var add_button = $("#addobjective");

            var x = 1; // First objective field.
            $(add_button).click(function(e){ // When they click "add objective"
                e.preventDefault();
                // Add the actual objective field to the form..
                $(add_button).after('' +
                    '<div class="form-group row card" style="margin-top:5px;margin-left:0px;padding: 10px;width:90%">' +
                        '<label for="example-text-input" class="col-form-label">Objective Name</label>' +
                        '<input class="form-control" type="text" id="objectiveName'+x+'" name="objectiveName'+x+'">' +
                        '<label for="example-text-input" class="col-form-label">Goal Text</label>' +
                        '<textarea class="form-control" type="text" id="goalText'+x+'" name="goalText'+x+'"></textarea>' +
                        '<label for="example-text-input" class="col-form-label">Objective Text</label>' +
                        '<textarea class="form-control" type="text" id="objectiveText'+x+'" name="objectiveText'+x+'"></textarea>' +
                        '<label for="example-text-input" class="col-form-label">Guidance Notes</label>' +
                        '<textarea class="form-control" type="text" id="guidanceNotes'+x+'" name="guidanceNotes'+x+'"></textarea>' +
                        '<label for="example-text-input" class="col-form-label">Frequency</label>' +
                        '<div class="row" style="padding-left: 15px;"><input class="form-control col-2" type="number" id="freqAmount'+x+'" name="freqAmount'+x+'">' +
                        '<select class="form-control col-5" id="freqKind'+x+'" name="freqKind'+x+'">' +
                        '<option>/Day</option><option>/Week</option><option>/Month</option></select></div>' +
                        '<button type="button" class="btn btn-danger remove_field" style="margin-top: 8px;">Remove Objective</button>' +
                    '</div>');
                // Now let's move the add button under what we just added and adjust the margins a tad.
                $(add_button).insertAfter($(add_button).next());
                $(add_button).css('margin-top', '-8px');
                x++; //Increment the objective number.
            });

            $(wrapper).on("click",".remove_field", function(e){ // when they click "remove objective"
                e.preventDefault(); $(this).parent('div').remove();
            })
        });
    </script>
    <!--Modal-->
    <script>
        $('#archivePatientConfirmationModal').on('shown.bs.modal', function () {
            var link = $(this).data('link');
            var patientName = $(this).data('patient-name');
            $(this).find('.warning-message .patientName').text(patientName);
        })

        $('.confirm-link').on('click', function (e) {
            e.preventDefault();

            var link = $(this).data('link');
            var patientName = $(this).data('patient-name');
            $('#archivePatientConfirmationModal').data({'link': link, 'patient-name': patientName}).modal('show');
        });

        $('#archivePatientConfirmationModal .confirm').click(function () {
            // handle redirect here
            var link = $('#archivePatientConfirmationModal').data('link');
            location.href = link;
            $('#archivePatientConfirmationModal').modal('hide');
        });
    </script>
{% endblock %}