{% extends 'base.html.twig' %}
{% block title %}Patients Page{% endblock %}
{% block body %}
    <br/>

    <!-- Nav tabs -->
    <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" data-toggle="tab" href="#view" role="tab">View</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#create" role="tab">Create</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#export" role="tab">Export</a>
        </li>
    </ul>


    <br/>


    <!-- Tab panes -->
    <div class="tab-content">

        <div class="tab-pane active" id="view" role="tabpanel">
            <table id="patients" class="table table-striped table-bordered" cellspacing="0">
                <thead>
                <tr>
                    {#<th>ID</th>#}
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Insurance</th>
                    <th>Manage</th>
                </tr>
                </thead>
                <tfoot>
                <tr>
                    {#<th>ID</th>#}
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Insurance</th>
                    <th>Manage</th>
                </tr>
                </tfoot>
                <tbody>
                {% for patient in patientsQuery.active %}
                    <tr>
                        {#<td>{{ patient.id }}</td>#}
                        <td>{{ patient.firstName }}</td>
                        <td>{{ patient.lastName }}</td>
                        <td>{{ patient.insurance }}</td>
                        <td>
                            <!-- Example split danger button -->
                            <div class="btn-group">
                                <a role="button" class="btn btn-primary" href="patient/{{ patient.id }}">View</a>
                                <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split"
                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <span class="sr-only">Toggle Dropdown</span>
                                </button>
                                <div class="dropdown-menu">
                                    <h6 class="dropdown-header">Create</h6>
                                    <a class="dropdown-item" href="#">Internal Incident</a>
                                    <a class="dropdown-item" href="#">Body Check</a>
                                    <a class="dropdown-item" href="#">Bowl Movement</a>
                                    <div class="dropdown-divider"></div>
                                    <h6 class="dropdown-header">Manage Data</h6>
                                    <a class="dropdown-item confirm-link"
                                       data-patient-name="{{ patient.firstName }} {{ patient.lastName }}"
                                       data-link="{{ patient.id }}/archive">Archive</a>
                                </div>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="tab-pane fade" id="create" role="tabpanel">
            <!-- Add Patient Form -->
            <form class="container form" action="create/" type="POST">
                <div class="row">
                    <div class="form-group col-sm-6">
                        <label for="first_name" class="col-form-label">First Name</label>
                        <input id="first_name" name="first_name" class="form-control" placeholder="John" required>
                    </div>
                    <div class="form-group col-sm-6">
                        <label for="last_name" class="col-form-label">Last Name</label>
                        <input id="last_name" name="last_name" class="form-control" placeholder="Adams" required>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-sm-6">
                        <label for="insurace" class="col-form-label">Insurace</label>
                        <input id="insurance" name="insurance" class="form-control" placeholder="Cigna Health Care"
                               required>
                    </div>
                    <div class="form-group col-sm-6">
                        <label for="insurace" class="col-form-label">Medical ID</label>
                        <input id="medical_id" name="medical_id" class="form-control" placeholder="555111222" required
                               type="number">
                    </div>
                </div>
                <div id="AddPatientNick" class="row">
                    <div class="form-group col-sm-12">
                        <label for="nick" class="col-form-label">Nickname</label>
                        <input id="nick" name="nick"
                               data-toggle="tooltip" data-placement="top"
                               title="Make it easier to identify the patient if two patients share the same name."
                               id="insurance"
                               class="form-control" placeholder="Johnny Family">
                    </div>
                </div>
                <div class="float-right">
                    <button type="submit" class="btn btn-warning">Submit</button>
                </div>
            </form>
            <!-- End Add Patient Form -->
        </div>

        <div class="tab-pane" id="export" role="tabpanel">...</div>
    </div>


    <!-- Modals -->
    <div class="modal fade" id="archivePatientConfirmationModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Archiving Patient</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <br/>
                    <div class="alert alert-warning" role="alert">
                        <strong>Confirmation: </strong>
                        <span class="warning-message">
                            Are you sure you wish to archive <span class="patientName">patientX</span>
                        </span>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn btn-warning confirm">Archive Patient</a>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/dataTables.bootstrap4.min.css">
    <script src="//cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <script src="//cdn.datatables.net/1.10.16/js/dataTables.bootstrap4.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#patients').DataTable();
            $('[data-toggle="tooltip"]').tooltip()
        });
    </script>

    //Modal
    <script>
        $('#archivePatientConfirmationModal').on('shown.bs.modal', function () {
            var link = $(this).data('link');
            var patientName = $(this).data('patient-name');
            $(this).find('.warning-message .patientName').text(patientName);
        })

        $('.confirm-link').on('click', function (e) {
            e.preventDefault();

            var link = $(this).data('link');
            var patientName = $(this).data('patient-name');
            $('#archivePatientConfirmationModal').data({'link': link, 'patient-name': patientName}).modal('show');
        });

        $('#archivePatientConfirmationModal .confirm').click(function () {
            // handle redirect here
            var link = $('#archivePatientConfirmationModal').data('link');
            location.href = link;
            $('#archivePatientConfirmationModal').modal('hide');
        });
    </script>
{% endblock %}